import json
import os
import requests
from bs4 import BeautifulSoup

'''
Get GTFOBIN for program if exists
'''

LOCATION = "https://gtfobins.github.io/"

def get_gtfobin():
    res = {}
    page = requests.get(LOCATION)

    soup = BeautifulSoup(page.content, "html.parser")

    for v in soup.find_all('a', class_="bin-name"):
        url = v['href']
        text = v.text

        res[text] = {}
        
        get_specific_page(res,text, url)
    
    save_to_file(res)



def get_specific_page(res, text, url):
    page = requests.get(f"{LOCATION}{url}")

    soup = BeautifulSoup(page.content, "html.parser")

    for v in soup.find_all('h2', class_="function-name"):
        code = v.findNext("code", class_="")
        code_array = code.text.split("\n")
        header = v.text

        res[text][header] = {}

        res[text][header]["code"] = code_array

def save_to_file(res):
    with open(f"{os.getcwd()}/gtfobins.json", "w+") as f:
        f.write(json.dumps(res, indent=4))
