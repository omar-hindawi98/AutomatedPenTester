#!/usr/bin/env python3
# -*- coding: utf-8 -*-

import redis


class RedisClient(object):

    def __init__(self, host='localhost', port=6379, db=0, password=None, socket_timeout=None, scan_id=0):
        try:
            self._connection = redis.Redis(host=host, port=port, db=db, password=password, socket_timeout=socket_timeout)
            self._scan_id = scan_id
            self._connected = True
        except Exception:
            self._connected = False

    def is_connected(self):
        return self._connected

    def get_connection(self):
        return self._connection

    def module_publish(self, module, stage, status):
        try:
            self._connection.publish(
                str(self._scan_id),
                f"MODULE:{module.upper()}:{stage._name_.lower()}:{status._name_.lower()}"
            )
        except Exception:
            pass

    def regtest_publish(self, regtest, status):
        try:
            self._connection.publish(
                str(self._scan_id),
                f"REGTEST:{regtest.upper()}:{status._name_.lower()}"
            )
        except Exception:
            pass

    def close(self):
        if self._connected:
            self._connected = False
            self._connection.close()
